<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="login">
	<select id="isUserExists" resultClass="java.lang.Integer" parameterClass="java.lang.String">
		SELECT 
			COUNT(0)
		FROM USERS  
		WHERE LOWER(USERNAME)=LOWER(#userName#)
	</select>
	
	<select id="isUserValidated" resultClass="java.lang.Integer" parameterClass="java.util.HashMap">
		SELECT 
			COUNT(0)
		FROM USERS  
		WHERE LOWER(USERNAME)=LOWER(#userName#) AND
			  PASSWORD=dbms_crypto.hash(to_clob(#password#), 2)
	</select>
	
	<select id="getUserDetails" resultClass="prime.login.LoginBean" parameterClass="java.lang.String">
		SELECT 
				USERNAME 		as userName,
				IS_ACTIVE_DIR 	as isActiveDirectory,
				STATUS_USER		as statusUser,
				LOGIN_SESSION	as loginSession,
				EMPLOYEE_ID		as employeeId,
				SYSTEM_LEVEL	as systemLevel,
				ACTION_DATE		as actionDate
		FROM USERS  
		WHERE LOWER(USERNAME)=LOWER(#name#)
	</select>
	
	<update id="setLoginSession" parameterClass="java.lang.String">
		UPDATE USERS 
		SET 
			LOGIN_SESSION = dbms_crypto.hash(to_clob(SYSDATE), 2),
			LAST_ACTIVE   = SYSDATE 
		WHERE USERNAME=#username#
	</update>
	
	<select id="getLoginSession" resultClass="java.lang.String"  parameterClass="java.lang.String">
		SELECT LOGIN_SESSION FROM USERS WHERE USERNAME=#username#
	</select>
	
</sqlMap>